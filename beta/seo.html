<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="ä½ã€…æœ¨å‹•æ…‹è¦³æ¸¬äº‹å‹™æ‰€ã«ã‚ˆã‚‹å…¬å¼è¦³æ¸¬æ—¥è¨˜ã€‚è¢«é¨“ä½“ã€Œä½ã€…æœ¨ã€ã®æ–‡æˆ¿å…·æµå‹•ãŠã‚ˆã³ç”Ÿæ…‹ã‚’è¨˜éŒ²ãƒ»å…¬é–‹ã™ã‚‹ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ã‚µã‚¤ãƒˆã€‚">
    
    <!-- 1. ãƒ•ã‚©ãƒ³ãƒˆã®å„ªå…ˆåº¦åˆ¶å¾¡: fetchpriority="high" ã‚’è¿½åŠ  -->
    <link rel="preload" href="https://bessho-dev.github.io/sasaki/font/ZenKurenaido-Regular.ttf" as="font" type="font/ttf" crossorigin fetchpriority="high">
    
    <title>ä½ã€…æœ¨æ—¥è¨˜ | ä½ã€…æœ¨å‹•æ…‹è¦³æ¸¬äº‹å‹™æ‰€</title>

    <style>
        /* 2. ãƒ•ã‚©ãƒ³ãƒˆæç”»ã®æœ€é©åŒ–: font-display: swap ã‚’ç¶­æŒã—ã¤ã¤ã€ãƒ•ã‚©ãƒ³ãƒˆèª­ã¿è¾¼ã¿ä¸­ã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆå´©ã‚Œã‚’é˜²ã */
        @font-face {
            font-family: 'Zen Kurenaido';
            src: url('https://bessho-dev.github.io/sasaki/font/ZenKurenaido-Regular.ttf') format('truetype');
            font-display: swap; 
            unicode-range: U+3000-30FF, U+4E00-9FAF, U+20-7E; 
        }
        @font-face {
            font-family: 'Yomogi';
            src: url('https://bessho-dev.github.io/sasaki/font/Yomogi-Regular.ttf') format('truetype');
            font-display: swap;
            unicode-range: U+3000-30FF, U+4E00-9FAF, U+20-7E;
        }

        :root {
            --c-bg: #fcf9f2;
            --c-text: #4e3629;
            --c-primary: #8d6e63;
            --c-accent: #ffab91;
            --c-white: #ffffff;
            --c-shadow: rgba(78, 54, 41, 0.15);
            --font-main: 'Zen Kurenaido', sans-serif;
            --font-sub: 'Yomogi', cursive;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            background-color: var(--c-bg);
            color: var(--c-text);
            font-family: var(--font-main);
            line-height: 1.8;
            overflow-x: hidden;
            /* 3. ãƒ†ã‚­ã‚¹ãƒˆãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã®é«˜é€ŸåŒ– */
            text-rendering: optimizeSpeed;
        }

        /* --- ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ --- */
        #app {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            /* content-visibility: auto; ã¯åˆå›æç”»ã‚’é€Ÿãã™ã‚‹ãŒã€h3ã®è¨ˆç®—ã‚’é…ã‚‰ã›ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ã®ã§ä»Šå›ã¯é™¤å» */
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 40px 0;
            margin-bottom: 20px;
        }

        .brand { display: flex; align-items: center; gap: 15px; cursor: pointer; }

        .sasaki-face {
            width: 50px; height: 50px;
            background: #8d6e63;
            border-radius: 40% 60% 70% 30% / 40% 50% 60% 50%;
            position: relative;
            box-shadow: 2px 4px 0 var(--c-shadow);
        }

        h1 { font-size: 2.2rem; font-weight: normal; letter-spacing: 0.1em; }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
            gap: 30px;
        }

        .card {
            background: var(--c-white);
            border: 2px solid var(--c-text);
            border-radius: 5px 20px 5px 20px;
            padding: 25px;
            position: relative;
            height: 100%;
            display: flex;
            flex-direction: column;
            /* åˆå›è¡¨ç¤ºã®ãƒãƒ©ã¤ãé˜²æ­¢ */
            will-change: transform;
        }
        
        .card-meta { font-size: 0.9rem; color: #888; margin-bottom: 10px; }
        .card h3 { font-size: 1.4rem; margin-bottom: 15px; line-height: 1.3; }
        .card-preview { font-size: 0.95rem; margin-bottom: 20px; flex-grow: 1; }
        .tags { display: flex; flex-wrap: wrap; gap: 8px; }
        .tag { font-size: 0.8rem; color: var(--c-primary); background: #efebe9; padding: 2px 8px; border-radius: 4px; }
        
        .mood-tracker {
            position: absolute; top: -10px; right: -10px;
            width: 30px; height: 30px;
            background: var(--c-accent); border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            border: 2px solid var(--c-text);
        }

        .search-container { margin: 0 auto 60px; max-width: 400px; }
        .search-input {
            width: 100%; padding: 15px 25px;
            border: 2px solid var(--c-text);
            border-radius: 255px 15px 225px 15px / 15px 225px 15px 255px;
            font-family: var(--font-main);
            background: transparent;
        }

        /* 4. ã‚¹ã‚±ãƒ«ãƒˆãƒ³ã®è»½é‡åŒ–ã¨ã€å³åº§ã«éš ã›ã‚‹è¨­å®š */
        .skeleton-wrapper {
            display: block;
        }
        .loaded .skeleton-wrapper {
            display: none;
        }

        @keyframes shine {
            to { background-position-x: -200%; }
        }
        .skeleton {
            background: linear-gradient(110deg, #ececec 8%, #f5f5f5 18%, #ececec 33%);
            background-size: 200% 100%;
            animation: 1.5s shine linear infinite;
            border-radius: 4px;
        }
    </style>
</head>
<body>

<div id="app">
    <header>
        <div class="brand" onclick="location.reload()">
            <div class="sasaki-face"></div>
            <h1>ä½ã€…æœ¨æ—¥è¨˜</h1>
        </div>
    </header>

    <div id="view-home">
        <div class="search-container">
            <input type="text" class="search-input" placeholder="ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚„ #ã‚¿ã‚° ã§æ¤œç´¢...">
        </div>

        <div id="digest-container">
            <!-- 5. ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°(SSR)ã‚’æ¨¡å€£ã—ã€JSå®Ÿè¡Œå‰ã«ã€Œæ ã€ã‚’ç¢ºä¿ -->
            <div class="skeleton-wrapper">
                <div class="grid">
                    <div class="card"><div class="skeleton" style="height:200px"></div></div>
                    <div class="card"><div class="skeleton" style="height:200px"></div></div>
                    <div class="card"><div class="skeleton" style="height:200px"></div></div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // 6. ãƒ‡ãƒ¼ã‚¿ã‚’å³æ™‚åˆ©ç”¨å¯èƒ½ãªå®šæ•°ã¨ã—ã¦é…ç½®
    const MOCK_DB = [
        { id: 101, title: "é‹å–¶ã‹ã‚‰ã®é€šé”: è¦³æ¸¬ã‚·ã‚¹ãƒ†ãƒ  v3.1", date: "2026.02.15", mood: "ğŸ“¢", tags: ["System", "Update"], digest: "é€šé”", content: "ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°é…å»¶ã‚’2.2ç§’çŸ­ç¸®ã€‚å³æ™‚æç”»ã‚¨ãƒ³ã‚¸ãƒ³æ­è¼‰ã€‚" },
        { id: 4, title: "ä½ã€…æœ¨ã€Œãƒã‚¦ãƒ³ãƒ†ãƒ³ã‚´ãƒªãƒ©ã§ã—ã‚‡ã€", date: "2026-02-02", mood: "ğŸ¦", tags: ["ä½ã€…æœ¨", "ã‚¹ãƒãƒ›"], digest: "ä½ã€…æœ¨æƒ…å ±", content: "ä½ã€…æœ¨ã®ã‚¹ãƒãƒ›ç”»é¢ã«ã¯ã€Œãƒã‚¦ãƒ³ãƒ†ãƒ³ã‚´ãƒªãƒ©ã€ã¨è¡¨ç¤ºã•ã‚Œã¦ã„ãŸã€‚" },
        { id: 5, title: "å®‰å¥ªé«˜å®ˆ å¤§ä½œæˆ¦", date: "2026-02-02", mood: "ğŸƒ", tags: ["ä½ã€…æœ¨"], digest: "ä½ã€…æœ¨æƒ…å ±", content: "é«˜ä¾¡ãªç­†ç®±ã‚’3300å††ã§è³¼å…¥ã—ã€è²¡æ”¿ç ´ç¶»ã—ãŸã€‚" },
        { id: 6, title: "ä½ã€…æœ¨ã®å¼·ãŒã‚Šæ–¹", date: "2026-01-XX", mood: "ğŸ˜", tags:["ä½ã€…æœ¨"], digest: "ä½ã€…æœ¨æƒ…å ±", content: "æ€’ã‚‰ã‚ŒãŸå¾Œã«ãƒ‹ãƒ¤ã¤ãã®ã¯ã€å½¼ã®æœ€å¤§ã®é˜²å¾¡åå¿œã§ã‚ã‚‹ã€‚" },
        { id: 1, title: "ä½ã€…æœ¨æ—¥è¨˜ã®é‹å–¶é–‹å§‹", date: "2026-02-12", mood: "â˜•", tags: ["ä½ã€…æœ¨"], digest: "ä½ã€…æœ¨æ—¥è¨˜", content: "è¦³æ¸¬ã‚’é–‹å§‹ã™ã‚‹ã€‚" },
    ];

    // 7. ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°é–¢æ•°ã®æœ€é©åŒ–ï¼ˆsetTimeoutã‚’æ’é™¤ï¼‰
    function renderApp() {
        const container = document.getElementById('digest-container');
        const digests = {};
        
        MOCK_DB.forEach(art => {
            const key = art.digest || "ãã®ä»–";
            if (!digests[key]) digests[key] = [];
            digests[key].push(art);
        });

        let html = '';
        Object.keys(digests).forEach(key => {
            const cards = digests[key].map(art => `
                <div class="card" onclick="console.log('ID: ${art.id}')">
                    <div class="mood-tracker">${art.mood}</div>
                    <div class="card-meta"><span>${art.date}</span></div>
                    <h3>${art.title}</h3>
                    <div class="card-preview">${art.content}</div>
                    <div class="tags">${art.tags.map(t => `<span class="tag">#${t}</span>`).join('')}</div>
                </div>
            `).join('');

            html += `
                <div class="digest-section" style="margin-bottom:60px;">
                    <div style="display:flex; align-items:center; gap:15px; margin-bottom:30px;">
                        <span style="font-size:1.8rem; background:linear-gradient(120deg, transparent 60%, #ffab91 60%); padding:0 10px;">${key}</span>
                        <div style="flex-grow:1; height:2px; background: repeating-linear-gradient(90deg, #4e3629 0, #4e3629 5px, transparent 5px, transparent 10px);"></div>
                    </div>
                    <div class="grid">${cards}</div>
                </div>
            `;
        });

        // 8. æ›¸ãæ›ãˆã€‚opacityã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã¯ã€LCPè¨ˆæ¸¬å¾Œã«è¡Œã‚ã‚Œã‚‹ã‚ˆã†ã‚·ãƒ³ãƒ—ãƒ«ã«ã€‚
        container.innerHTML = html;
        document.body.classList.add('loaded');
    }

    // 9. å®Ÿè¡Œã‚¿ã‚¤ãƒŸãƒ³ã‚°ã®åŠ‡çš„ãªæ”¹å–„
    // window.onload(å…¨ãƒªã‚½ãƒ¼ã‚¹èª­è¾¼å®Œäº†)ã‚’å¾…ãŸãšã€HTMLãƒ‘ãƒ¼ã‚¹å®Œäº†ç›´å¾Œã«å®Ÿè¡Œ
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', renderApp);
    } else {
        renderApp();
    }

    // ã‚µãƒ¼ãƒ“ã‚¹ãƒ¯ãƒ¼ã‚«ãƒ¼ï¼ˆä»»æ„ï¼‰
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
            navigator.serviceWorker.register('./sw.js').catch(() => {});
        });
    }
</script>

</body>
</html>
